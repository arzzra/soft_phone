# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç media_with_sdp

## üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–∞

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ SDP –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ –∏ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –º–µ–¥–∏–∞ —Å–µ—Å—Å–∏—è–º–∏ –Ω–∞ localhost, –≤–∫–ª—é—á–∞—è:

1. **SDP –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã**: Offer/Answer –æ–±–º–µ–Ω
2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–º–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ RTP/RTCP –ø–æ—Ä—Ç–æ–≤
3. **–û–±–º–µ–Ω –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–º–∏**: –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –ø–∞–∫–µ—Ç–æ–≤
4. **DTMF —Å–∏–≥–Ω–∞–ª—ã**: –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
5. **–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Å—Å–∏–π**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

## üìÅ –§–∞–π–ª—ã —Ç–µ—Å—Ç–∞

### `examples/media_with_sdp_functional_test/main.go`
–ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é:
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
- Callback —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ–±—ã—Ç–∏–π
- –û–±–º–µ–Ω –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–º–∏ –∏ DTMF —Å–∏–≥–Ω–∞–ª–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- Graceful –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π

### `examples/media_with_sdp_functional_test/simple_demo.go`
–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:
- –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–≤—É—Ö —Å–µ—Å—Å–∏–π
- SDP –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã Offer/Answer
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ –ø–æ—Ä—Ç–æ–≤
- –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ –æ–±–º–µ–Ω–∞

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∞

### –≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```go
// –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ localhost
config := media_with_sdp.DefaultMediaSessionWithSDPManagerConfig()
config.LocalIP = "127.0.0.1"
config.PortRange = media_with_sdp.PortRange{Min: 12000, Max: 12100}

manager, err := media_with_sdp.NewMediaSessionWithSDPManager(config)
```

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π
```go
// Caller (–∏—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫)
caller, err := manager.CreateSessionWithConfig("caller-001", callerConfig)

// Callee (–≤—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫)  
callee, err := manager.CreateSessionWithConfig("callee-002", calleeConfig)
```

### –≠—Ç–∞–ø 3: SDP –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã
```go
// 1. Caller —Å–æ–∑–¥–∞–µ—Ç offer
offer, err := caller.CreateOffer()

// 2. Callee –ø–æ–ª—É—á–∞–µ—Ç offer –∏ —Å–æ–∑–¥–∞–µ—Ç answer
err = callee.SetRemoteDescription(offer)
answer, err := callee.CreateAnswer(offer)

// 3. Caller –ø–æ–ª—É—á–∞–µ—Ç answer
err = caller.SetRemoteDescription(answer)
```

### –≠—Ç–∞–ø 4: –û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏
```go
// –ó–∞–ø—É—Å–∫ –º–µ–¥–∏–∞ —Å–µ—Å—Å–∏–π
err = caller.Start()
err = callee.Start()

// –û–±–º–µ–Ω –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–º–∏
err = caller.SendAudioRaw(testAudioData)
err = callee.SendAudioRaw(testAudioData)

// –û—Ç–ø—Ä–∞–≤–∫–∞ DTMF —Å–∏–≥–Ω–∞–ª–æ–≤
err = caller.SendDTMF(media.DTMF1, 200*time.Millisecond)
err = callee.SendDTMF(media.DTMF9, 200*time.Millisecond)
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### SDP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ SDP Offer —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –º–µ–¥–∏–∞ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–µ–≥–æ SDP
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ SDP Answer –Ω–∞ –æ—Å–Ω–æ–≤–µ Offer
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Local/Remote descriptions
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏—è SDP –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ (Idle ‚Üí LocalOffer ‚Üí RemoteOffer ‚Üí Established)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä –ø–æ—Ä—Ç–æ–≤ RTP/RTCP
- ‚úÖ –ß–µ—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è RTP, –Ω–µ—á–µ—Ç–Ω—ã–µ –¥–ª—è RTCP
- ‚úÖ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤ –ø–µ—Ä–µ–¥ –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º

### –ú–µ–¥–∏–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö –º–µ–¥–∏–∞ —Å–µ—Å—Å–∏–π
- ‚úÖ –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ MediaSessionInterface
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DTMF —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Å—Å–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ callback —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ Graceful shutdown –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### SDP Offer/Answer
```
‚úÖ SDP Offer —Å–æ–∑–¥–∞–Ω (XXX –±–∞–π—Ç)
üìã –ú–µ–¥–∏–∞ –æ–ø–∏—Å–∞–Ω–∏–π: 1
üìä –ü–µ—Ä–≤–æ–µ –º–µ–¥–∏–∞: audio, –ø–æ—Ä—Ç: 12000, —Ñ–æ—Ä–º–∞—Ç—ã: [0 8 9]

‚úÖ SDP Answer —Å–æ–∑–¥–∞–Ω (XXX –±–∞–π—Ç)
ü§ù SDP –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤
```
üìä –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤:
   Caller: established
   Callee: established
```

### –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã
```
üîå –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã:
   Caller: RTP=12000, RTCP=12001
   Callee: RTP=12002, RTCP=12003
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
```
üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞:
   –í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π: 2
   –ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π: 2
   –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ—Ä—Ç–æ–≤: 4
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
```bash
cd examples/media_with_sdp_functional_test
go run main.go
```

### –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
```bash
cd examples/media_with_sdp_functional_test  
go run simple_demo.go
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Callback —Ñ—É–Ω–∫—Ü–∏–∏
–¢–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç callback —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- `OnSessionCreated` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π
- `OnNegotiationStateChange` - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π SDP
- `OnPortsAllocated` - –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
- `OnRawAudioReceived` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö
- `OnDTMFReceived` - –ø–æ–ª—É—á–µ–Ω–∏–µ DTMF —Å–∏–≥–Ω–∞–ª–æ–≤

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–¥–µ–∫–∏
- **PCMU** (Œº-law) - Payload Type 0
- **PCMA** (A-law) - Payload Type 8  
- **G722** - Payload Type 9

### –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **IP**: 127.0.0.1 (localhost)
- **–ü–æ—Ä—Ç—ã RTP**: 12000, 12002, 12004, ...
- **–ü–æ—Ä—Ç—ã RTCP**: 12001, 12003, 12005, ...
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: RTP/AVP

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:

1. **–ü–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ
2. **SDP —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ–±–º–µ–Ω SDP –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ/–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
4. **–ú–µ–¥–∏–∞ –æ–±–º–µ–Ω** - –ø–µ—Ä–µ–¥–∞—á—É –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö –∏ DTMF —Å–∏–≥–Ω–∞–ª–æ–≤
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π

–ü–∞–∫–µ—Ç `media_with_sdp` –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —Å–æ—Ñ—Ç—Ñ–æ–Ω–∞! üéØ 