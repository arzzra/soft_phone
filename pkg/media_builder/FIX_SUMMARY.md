# Исправление проблемы обмена пакетами в media_builder

## Проблема
В функциональном тесте `pkg/media_builder/functional_test.go` аудио и DTMF пакеты не обменивались между участниками. Статистика показывала 0 полученных пакетов.

## Причина
Транспорт создавался в методе `CreateOffer()` до того, как был известен удаленный адрес (remoteAddr). В результате UDP транспорт не знал куда отправлять пакеты.

## Решение
Перенесли создание медиа ресурсов (транспорта и RTP сессии) из `CreateOffer()` в:
- `ProcessAnswer()` - для стороны, создающей offer (caller)
- `CreateAnswer()` - для стороны, обрабатывающей offer (callee)

### Изменения в builder.go:

1. **CreateOffer()** - удалили вызов `createMediaResources()`:
```go
// Не создаем медиа ресурсы здесь, так как еще не знаем remoteAddr
// Они будут созданы в ProcessAnswer после получения адреса удаленной стороны
return offer, nil
```

2. **ProcessAnswer()** - добавили создание ресурсов после установки remoteAddr:
```go
// Сохраняем удаленный адрес
b.remoteAddr = fmt.Sprintf("%s:%d", result.RemoteIP, result.RemotePort)
b.selectedPayloadType = result.SelectedPayloadType

// Теперь, когда у нас есть remoteAddr, создаем медиа ресурсы
if err := b.createMediaResources(); err != nil {
    return fmt.Errorf("не удалось создать медиа ресурсы: %w", err)
}
```

3. **CreateAnswer()** - создание ресурсов происходит после ProcessOffer, где устанавливается remoteAddr

## Результат
После исправления функциональный тест успешно обменивается пакетами:
- Caller получил 2 аудио пакета
- Callee получил 3 аудио пакета  
- Обменялись 5 DTMF сигналами

## Дополнительные улучшения
1. Добавлены callback-функции для отслеживания медиа событий
2. Создан набор комплексных интеграционных тестов
3. Все unit-тесты обновлены для соответствия новому поведению
4. Код прошел проверку линтером без ошибок

## Ключевой принцип
В SDP offer/answer модели транспорт должен создаваться только после того, как обе стороны знают адреса друг друга. Это происходит:
- Для caller: после получения answer
- Для callee: после обработки offer