# Требования для разработчика: Реализация проверки направления RTP сессий

## Контекст задачи
В текущей реализации методы отправки данных в медиа-сессиях не учитывают направление (direction) RTP сессий. Необходимо исправить эту проблему, чтобы данные отправлялись только на сессии, которые могут принимать отправку.

## Основные требования

### 1. Модифицировать метод `sendRTPPacket` в файле `pkg/media/session.go`

**Локация**: строки 1551-1571

**Что сделать**:
```go
// Перед строкой:
err := rtpSession.SendAudio(packetData, ms.ptime)

// Добавить проверку:
if !rtpSession.CanSend() {
    continue
}
```

### 2. Модифицировать метод `WriteAudioDirect` в файле `pkg/media/session.go`

**Локация**: строки 780-794

**Что сделать**:
```go
// В цикле for _, rtpSession := range ms.rtpSessions
// Добавить проверку перед отправкой:
if !rtpSession.CanSend() {
    continue
}
```

### 3. Модифицировать метод `SendDTMF` в файле `pkg/media/session.go`

**Локация**: строки 838-855

**Что сделать**:
```go
// После начала цикла по rtpSessions добавить:
if !rtpSession.CanSend() {
    continue
}
```

### 4. Модифицировать метод `addToAudioBuffer` в файле `pkg/media/session.go`

**Локация**: строки 1391-1400

**Что сделать**:
- Добавить блокировку для чтения RTP сессий
- Проверять направление перед добавлением в буфер сессии
- Пример кода указан в плане

### 5. Модифицировать метод `sendBufferedAudioForSession` в файле `pkg/media/session.go`

**Локация**: строки 1423-1475

**Что сделать**:
- Перед отправкой проверить, может ли сессия отправлять
- Если не может - очистить буфер для этой сессии

## Дополнительные требования

### Логирование
При необходимости можно добавить debug-логирование:
```go
if !rtpSession.CanSend() {
    slog.Debug("Пропускаем отправку на RTP сессию из-за направления", 
        "sessionID", sessionID, 
        "direction", rtpSession.GetDirection())
    continue
}
```

### Важные моменты
1. Метод `CanSend()` уже реализован в `pkg/rtp/session.go` и является thread-safe
2. Не генерировать ошибки при пропуске сессий - это нормальное поведение
3. Сохранить существующую логику обработки ошибок для реальных ошибок отправки
4. Убедиться, что статистика обновляется только для успешно отправленных пакетов

## Тестирование
После внесения изменений:
1. Запустить все тесты: `go test ./...`
2. Запустить линтер: `golangci-lint run`
3. Убедиться, что нет регрессий

## Файлы для изменения
- `pkg/media/session.go` - основной файл с изменениями

## Ожидаемый результат
- Данные отправляются только на RTP сессии с направлением `sendrecv` или `sendonly`
- Сессии с направлением `recvonly` или `inactive` пропускаются без ошибок
- Все тесты проходят успешно
- Линтер не выдает критических замечаний